<!DOCTYPE html>
{{- $defaultColor := .Site.Params.defaultColor | default "auto" -}}

{{/* allow website developer to enforce default dark mode */}}
{{- if eq $defaultColor "dark" -}}
<html lang="{{ .Site.LanguageCode }}" class="dark">
{{- else if eq $defaultColor "light" -}}
<html lang="{{ .Site.LanguageCode }}" class="light">
{{- else -}}
<html lang="{{ .Site.LanguageCode }}">
{{- end -}}

{{- partial "head.html" . -}}

<body data-theme="{{ $defaultColor }}" class="notransition">
    {{- partial "scriptsBodyStart.html" . -}}
    {{- partial "header.html" . -}}
    <div class="wrapper">
        {{ partial "bio" . }}
        <main aria-label="Content">
            {{/* —— Recent Posts 整块已删除 —— */}}

            <h3 class="posts-item-note">Recent Research</h3>

            {{ with .Site.Params.recentResearch }}
              {{/* 按 topic 升序、year 降序排序 */}}
              {{ $items := sort . "topic" "asc" "year" "desc" }}
              {{ $currentTopic := "" }}

              <div class="recent-research">
                {{ range $index, $item := $items }}
                  {{ $topic := (or $item.topic "Other") }}

                  {{/* 当 topic 变化时，关闭上一个 <ul>，并输出新的 topic 标题 */}}
                  {{ if ne $topic $currentTopic }}
                    {{ if ne $currentTopic "" }}
                      </ul>
                    {{ end }}
                    <h4 class="research-topic">{{ $topic }}</h4>
                    <ul class="recent-research-list">
                    {{ $currentTopic = $topic }}
                  {{ end }}

                  <li class="research-item">
                    <div class="research-title">
                      {{ with $item.url }}
                        <a href=" " target="_blank" rel="noopener">{{ $item.title }}</a >
                      {{ else }}
                        {{ $item.title }}
                      {{ end }}
                    </div>
                    <div class="research-meta">
                      {{ $item.venue }}, {{ $item.year }}
                    </div>
                  </li>
                {{ end }}

                {{/* 如果有至少一条记录，就补上最后一个 </ul> */}}
                {{ if gt (len $items) 0 }}
                  </ul>
                {{ end }}
              </div>
            {{ else }}
              <ul class="recent-research-list">
                <li><em>No research items configured yet.</em></li>
              </ul>
            {{ end }}

        </main>
    </div>
    {{- partial "footer.html" . -}}
    {{- partial "scriptsBodyEnd.html" . -}}
</body>
</html>